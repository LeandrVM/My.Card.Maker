<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card_Maker</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css" media="screen" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <button id="teste">teste</button>
    <header>
        <h1>Logo</h1>
    </header>
    <main>
        <div class="preview">
            <div class="ttlpreview">
                <h1>Preview</h1>
            </div>
            <div class="prepreview">
                <div class="numeracao">
                    <div class="numeracao1">    
                        <div>1</div>
                        <div>3</div>
                    </div>
                    <div class="numeracao2">
                        <div>2</div>
                        <div>4</div>
                    </div>
                </div>
                <div class="canpreview" id="a4-preview">
                    <canvas class="a4-sheet" id="myCanvas">
                        <div class="pair01">
                            <div class="paircard">
                                <div class="cancard"><img src="./Imagens/Back.png" style="transform: rotate(-90deg) scale(0.32);"></div>
                                <div class="cancard"><img src="./Imagens/Front00.png" id="canimg1" style="transform: rotate(-90deg) scale(0.32);"></div>
                            </div>
                            <div class="paircard">
                                <div class="cancard"><img src="./Imagens/Back.png" style="transform: rotate(-90deg) scale(0.32);"></div>
                                <div class="cancard"><img src="./Imagens/Front00.png" id="canimg2" style="transform: rotate(-90deg) scale(0.32);"></div>
                            </div>
                        </div>
                        <div class="pair02">
                            <div class="paircard">
                                <div class="cancard"><img src="./Imagens/Back.png" style="transform: rotate(-90deg) scale(0.32);"></div>
                                <div class="cancard"><img src="./Imagens/Front00.png" id="canimg3" style="transform: rotate(-90deg) scale(0.32);"></div>
                            </div>
                            <div class="paircard">
                                <div class="cancard"><img src="./Imagens/Back.png" style="transform: rotate(-90deg) scale(0.32);"></div>
                                <div class="cancard"><img src="./Imagens/Front00.png" id="canimg4" style="transform: rotate(-90deg) scale(0.32);"></div>
                            </div>
                        </div>
                    </canvas>
                </div>
            </div>
        </div>
        <div class="editor">
            <div class="cardseditor">
                <div class="ttlcards">
                    <h2>Front</h2>
                    <h2>Back</h2>
                </div>
                <div class="cards">
                    <div class="card 01">
                        <img id="bg_front" class="imgfront" src="./Imagens/Front02.png">
                        <div class="cd">
                            <div class="cdstema" id="">
                                <h1 id="card_tema">Tema</h1>
                            </div>
                            <div class="cdstexto">
                                <h2 id="card_texto">Texto</h2>
                            </div>
                            <div class="cdsowner">
                                <h2 id="card_owner">Owner</h2>
                            </div>
                        </div>
                    </div>
                    <div class="card 02">
                        <img id="bgbackcard" src="./Imagens/Back.png">
                    </div>
                </div>
            </div>
            
            <div class="edit">
                <div class="selectcards">
                    <button class="btnprev" id="btn_prev">Prev</button>
                    <h2 id="Carta_Numero">Carta</h2>
                    <button class="btnnext" id="btn_next">Next</button>
                </div>
                <div class="editop">
                    <div class="op 01">
                        <div class="opit Tema">
                            <h3>Tema</h3>
                            <input id="input_tema" type="text" placeholder="Digite o Tema aqui" maxlength="20">
                        </div>
                        <div class="opit Texto">
                            <h3>Texto</h3>
                            <textarea id="input_texto" type="text" rows="2" cols="20"placeholder="Digite seu Texto aqui"></textarea>
                        </div>
                    </div>
                    <div class="op02">
                        <div class="opit Valor">
                            <h3>Valor</h3>
                            <div class="input_valor_completo">
                                <input id="input_valor" type="range" placeholder="Valor da carta" min="0" max="3" value="2" step="1">
                                <p><span id="input_carta"></span></p>
                            </div>
                        </div>
                        <div class="opit Owner">
                            <h3>Owner</h3>
                            <input id="input_owner" type="text" placeholder="Digite seu nome aqui" maxlength="10">
                        </div>
                    </div>
                </div>
            </div>
            <button id="downloadBtn">Baixar Imagem</button>
        </div>
    </main>

    <script>
        const InputTema = document.getElementById('input_tema');
const Tema = document.getElementById('card_tema');

InputTema.addEventListener('input', function() {
    Tema.innerText = InputTema.value || 'Tema';
});

const InputTexto = document.getElementById('input_texto');
const Texto = document.getElementById('card_texto');

InputTexto.addEventListener('input', function() {
    Texto.innerText = InputTexto.value || 'Texto';
});

const InputOwner = document.getElementById('input_owner');
const Owner = document.getElementById('card_owner');

InputOwner.addEventListener('input', function() {
    Owner.innerText = InputOwner.value ? `by- ${InputOwner.value}` : 'Owner';
});

const range = document.getElementById('input_valor');
const valor = document.getElementById('input_carta');
const bgfront = document.getElementById('bg_front');
const bgfront1 = document.getElementById('canimg1');
const bgfront2 = document.getElementById('canimg2');
const bgfront3 = document.getElementById('canimg3');
const bgfront4 = document.getElementById('canimg4');


 

// Atualiza o valor exibido em tempo real
range.addEventListener('input', function() {
    valor.innerText = range.value;
    ValData[CartaAtual] = valor.innerText
    bgfront.src = `./Imagens/Front0${valor.innerText}mini.png`;
    bgfront1.src =  `./Imagens/Front0${ValData[1] || 2}.png`;
    bgfront2.src =  `./Imagens/Front0${ValData[2] || 2}.png`;
    bgfront3.src =  `./Imagens/Front0${ValData[3] || 2}.png`;
    bgfront4.src =  `./Imagens/Front0${ValData[4] || 2}.png`;


});

// Exibe o valor inicial
valor.innerText = range.value;

let CartaAtual = 1;
const MaxCarta = 4;
const btn_next = document.getElementById('btn_next');
const btn_prev = document.getElementById('btn_prev');


// Inicialização dos dados das cartas
let TemData = {
    1: '',
    2: '',
    3: '',
    4: ''
};

let TexData = {
    1: '',
    2: '',
    3: '',
    4: ''
};

let ValData = {
    1: '',
    2: '',
    3: '',
    4: ''
};

let OwnData = {
    1: '',
    2: '',
    3: '',
    4: ''
};

// Função para atualizar o conteúdo da carta e o preview
function updateCard() {
    // Atualiza os inputs
    document.getElementById("Carta_Numero").innerText = `Carta_${CartaAtual}`;
    document.getElementById('input_tema').value = TemData[CartaAtual];
    document.getElementById('input_texto').value = TexData[CartaAtual];
    document.getElementById('input_owner').value = OwnData[CartaAtual];
    document.getElementById('input_valor').value = ValData[CartaAtual];
    
    // Atualiza o preview
    Tema.innerText = TemData[CartaAtual] || 'Tema';
    Texto.innerText = TexData[CartaAtual] || 'Texto';
    Owner.innerText = OwnData[CartaAtual] ? `by- ${OwnData[CartaAtual]}` : 'Owner';
    valor.innerText = ValData[CartaAtual] || 2;
    bgfront.src = `./Imagens/Front0${ValData[CartaAtual] || 2}mini.png`;
    bgfront1.src =  `./Imagens/Front0${ValData[1] || 2}.png`; 
    bgfront2.src =  `./Imagens/Front0${ValData[2] || 2}.png`; 
    bgfront3.src =  `./Imagens/Front0${ValData[3] || 2}.png`;
    bgfront4.src =  `./Imagens/Front0${ValData[4] || 2}.png`;
    
    // Habilitar/desabilitar botões
    document.getElementById("btn_prev").disabled = CartaAtual === 1;
    document.getElementById("btn_next").disabled = CartaAtual === MaxCarta;
}

// Função para avançar para a próxima carta
function nextCard() {
    if (CartaAtual < MaxCarta) {
        // Salva os valores atuais antes de mudar de carta
        TemData[CartaAtual] = document.getElementById('input_tema').value;
        TexData[CartaAtual] = document.getElementById('input_texto').value;
        OwnData[CartaAtual] = document.getElementById('input_owner').value;
        ValData[CartaAtual] = document.getElementById('input_valor').value;
        
        CartaAtual++;
        updateCard();
    }
}

// Função para voltar para a carta anterior
function previousCard() {
    if (CartaAtual > 1) {
        // Salva os valores atuais antes de mudar de carta
        TemData[CartaAtual] = document.getElementById('input_tema').value;
        TexData[CartaAtual] = document.getElementById('input_texto').value;
        OwnData[CartaAtual] = document.getElementById('input_owner').value;
        ValData[CartaAtual] = document.getElementById('input_valor').value;
        
        CartaAtual--;
        updateCard();
    }
}

// Adiciona eventos aos botões de navegação
btn_next.addEventListener("click", nextCard);
btn_prev.addEventListener("click", previousCard);

updateCard();



        const bgcardpadrao = document.getElementById('bgbackcard')
        const a4Width = 2480; // 210 mm em pixels (300 DPI)
        const a4Height = 3508; // 297 mm em pixels (300 DPI)
        const cardWidth = 744;  // 63 mm em pixels (300 DPI)
        const cardHeight = 1039; // 88 mm em pixels (300 DPI)

        // Espaçamento entre as duplas de cartas e entre fileiras
        const spaceBetweenDuplas = 50; // Espaçamento entre as duplas
        const spaceBetweenRows = 100; // Espaçamento entre as fileiras

        // Função para carregar a imagem de input
        function loadImageFromFile(inputElement) {
            return new Promise((resolve, reject) => {
                const file = inputElement.files[0];
                if (!file) {
                    reject("Nenhum arquivo foi selecionado.");
                    return;
                }

                const img = new Image();
                const reader = new FileReader();

                reader.onload = function(event) {
                    img.src = event.target.result;
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                };
                reader.onerror = reject;

                reader.readAsDataURL(file);
            });
        }

        // Função para desenhar o texto na carta
        function drawTextOnCard(ctx, text, x, y, fontSize = 40, fontColor = 'white', fontFamily = 'Arial') {
            ctx.font = `${fontSize}px ${fontFamily}`;
            ctx.fillStyle = fontColor;
            ctx.textAlign = 'center'; // Centraliza o texto horizontalmente
            ctx.fillText(text, x, y);
        }

        // Função para desenhar uma dupla de cartas (uma fixa e uma trocável)
        function drawCardPair(ctx, fixedImg, changeableImg, startX, startY, tema, texto, criador) {
            // Desenha a carta fixa
            ctx.drawImage(fixedImg, startX, startY, cardWidth, cardHeight);
            // Desenha a carta trocável
            ctx.drawImage(changeableImg, startX + cardWidth, startY, cardWidth, cardHeight);

            // Posição para desenhar o texto apenas na carta trocável
            const cardX = startX + cardWidth + cardWidth / 2;

            // Desenha o texto sobre a carta trocável
            drawTextOnCard(ctx, texto, cardX, startY + cardHeight / 2, 40, 'white'); // Texto no meio
            drawTextOnCard(ctx, tema, cardX, startY + 100, 50, 'white'); // Tema no topo
            drawTextOnCard(ctx, criador, cardX, startY + cardHeight - 50, 35, 'white'); // Criador no rodapé
        }

        // Função para gerar a folha A4 com as cartas e baixar
        async function generateAndDownload() {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    // Define o tamanho do canvas para o tamanho da folha A4
    canvas.width = a4Width;
    canvas.height = a4Height;

    // Fundo branco para a folha A4
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, a4Width, a4Height);

    try {
        const fixedImg = new Image();
        fixedImg.crossOrigin = "anonymous"; // Adiciona esta linha
        fixedImg.src = bgcardpadrao.src; // Aqui, certifique-se de que bgcardpadrao é um objeto de imagem

        const img1 = new Image();
        img1.crossOrigin = "anonymous"; // Adiciona esta linha
        img1.src = bgfront1.src;

        const img2 = new Image();
        img2.crossOrigin = "anonymous"; // Adiciona esta linha
        img2.src = bgfront2.src;

        const img3 = new Image();
        img3.crossOrigin = "anonymous"; // Adiciona esta linha
        img3.src = bgfront3.src;

        const img4 = new Image();
        img4.crossOrigin = "anonymous"; // Adiciona esta linha
        img4.src = bgfront4.src;

        // Aguarda todas as imagens serem carregadas
        await Promise.all([
            fixedImg.decode(), 
            img1.decode(), 
            img2.decode(), 
            img3.decode(), 
            img4.decode()
        ]);
              
                // Obtém os valores do tema, texto e criador de cada dupla
                const tema1 = TemData[1];
                const texto1 = TexData[1];
                const criador1 = OwnData[1];

                const tema2 = TemData[2];
                const texto2 = TexData[2];
                const criador2 = OwnData[2];

                const tema3 = TemData[3];
                const texto3 = TexData[3];
                const criador3 = OwnData[3];

                const tema4 = TemData[4];
                const texto4 = TexData[4];
                const criador4 = OwnData[4];

                // Calcula a posição inicial para centralizar as duplas
                const totalWidthForPairs = 2 * (2 * cardWidth + spaceBetweenDuplas);
                const totalHeightForRows = 2 * cardHeight + spaceBetweenRows;

                // Calcula a posição inicial para centralizar as duplas
                const startX = (a4Height - totalWidthForPairs) / 2;
                const startY = (a4Width - totalHeightForRows) / 2;

                // Rotaciona o canvas em 90 graus
                ctx.translate(a4Width / 2, a4Height / 2); // Muda o ponto de origem para o centro
                ctx.rotate(90 * Math.PI / 180); // Rotaciona 90 graus
                ctx.translate(-a4Height / 2, -a4Width / 2); // Muda de volta

                // Desenha as duas duplas de cartas
                for (let row = 0; row < 2; row++) {
                    // Calcula o Y para cada fileira
                    const currentY = startY + row * (cardHeight + spaceBetweenRows);

                    for (let pair = 0; pair < 2; pair++) {
                        // Calcula o X para cada dupla
                        const currentX = startX + pair * (2 * cardWidth + spaceBetweenDuplas);

                        // Desenha uma dupla de cartas com texto
                        if (row === 0 && pair === 0) {
                            drawCardPair(ctx, fixedImg, img1, currentX, currentY, tema1, texto1, criador1);
                        } else if (row === 0 && pair === 1) {
                            drawCardPair(ctx, fixedImg, img2, currentX, currentY, tema2, texto2, criador2);
                        } else if (row === 1 && pair === 0) {
                            drawCardPair(ctx, fixedImg, img3, currentX, currentY, tema3, texto3, criador3);
                        } else if (row === 1 && pair === 1) {
                            drawCardPair(ctx, fixedImg, img4, currentX, currentY, tema4, texto4, criador4);
                        }
                    }
                }

                // Cria o link para download da imagem
                const link = document.createElement('a');
        link.download = 'folhaA4_com_cartas_centralizadas.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    } catch (error) {
        console.error("Erro: ", error);
        alert("Erro ao gerar a imagem.");
    }
}
        // Adiciona evento ao botão de download
        document.getElementById('downloadBtn').addEventListener('click', generateAndDownload);
        document.getElementById('downloadBtn').addEventListener('click', updateCard());

</script>
</body>
</html>